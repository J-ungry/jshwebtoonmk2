{% extends "nav.html" %}
{% block title %}승환이네 만화방{% endblock %}

{% block content %}
<!-- css 중복되는 코드가 너무 많아서 수정 필요 -->
<style>
    ul li {
        cursor: pointer;
    }

    ul li:hover {
        background-color: #efefef;
    }

    /* 서정우한테 맡긴다. */
    ul li:focus {
        background-color: #1e8ee7;
    }
</style>

<!-- 사용자 keyword 입력 -->
    <div class="w-75 p-3 mt-5" style="margin: 0 auto;">
        <div class="p-3 d-flex justify-content-between align-items-center" style="background-color: #252c3a;">
            <div class="align-self-center">
                <img class="rounded float-start"    style="width:40px;" src="{{url_for('static',filename='img/baseline_search_white_24dp.png')}}">
                <span class="me-1" style="color: #fff; font-size: 27px;"><strong>웹툰 키워드로 검색하기</strong></span>
                <span style="color: #fff;">키워드로 마음에 드는 웹툰을 찾아보세요!</span>
            </div>
            <div class="p-2" style="border: 1px solid #fff; border-radius: 5px; cursor: pointer;">
                <p style="color: #fff;"><strong>전체 해제</strong></p>
            </div> 
        </div>
    <!-- focus 추가, height 추가(잘안댐..) -->
    <div class="p-2 d-flex justify-content-between" style="background-color: #e6f6ff; border: 1.5px solid #cddde6;">
        <div class="w-25 me-2 p-2">           
            <h5 class="p-1" style="font-size: 15px; font-weight: lighter; border-bottom: 1.5px solid #cddde6;">장르</h5>
            <div style="height: 100px; overflow: auto;">
                <ul style="font-weight: bolder; color: #23466e;" class="p-2">
                    <!-- 장르 -->
                    {% for gen in genre %}
                        <li name="1" class="p-1 user_keyword">{{gen}}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="w-25 me-2 p-2">
            <h5 class="p-1" style="font-size: 15px; font-weight: lighter; border-bottom: 1.5px solid #cddde6;">소재</h5>
            <div style="height: 100px; overflow: auto;">
                <ul style="font-weight: bolder; color: #23466e;" class="p-2">
                    <!-- 소재 -->
                    {% for soj in sojae %}
                        <li name="2" class="p-1 user_keyword">{{soj}}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="w-25 me-2 p-2">
            <h5 class="p-1" style="font-size: 15px; font-weight: lighter; border-bottom: 1.5px solid #cddde6;">분위기</h5>
            <div style="height: 100px; overflow: auto;">
                <ul style="font-weight: bolder; color: #23466e;" class="p-2">
                    <!-- 분위기 -->
                    {% for atm in atm %}
                        <li name="3" class="p-1 user_keyword">{{atm}}</li>
                    {% endfor %}
                </ul> 
            </div>
        </div>
        <div class="w-25 me-2 p-2">
            <h5 class="p-1" style="font-size: 15px; font-weight: lighter; border-bottom: 1.5px solid #cddde6;">등장인물/관계</h5>      
            <div style="height: 100px; overflow: auto;">
                <ul style="font-weight: bolder; color: #23466e;" class="p-2">
                    <!-- 등장인물/관계 -->
                    {% for chr in chrel %}
                        <li name="5" class="p-1 user_keyword">{{chr}}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="w-25 me-2 p-2">
            <h5 class="p-1" style="font-size: 15px; font-weight: lighter; border-bottom: 1.5px solid #cddde6;">수상작</h5>      
            <div style="height: 100px; overflow: auto;">
                <ul style="font-weight: bolder; color: #23466e;" class="p-2">
                    <!-- 수상작 -->
                    {% for soo in soosang %}
                        <li name="4" class="p-1 user_keyword">{{soo}}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="w-25 me-2 p-2">
            <h5 class="p-1" style="font-size: 15px; font-weight: lighter; border-bottom: 1.5px solid #cddde6;">원작웹툰</h5>      
            <div style="height: 100px; overflow: auto;">
                <ul style="font-weight: bolder; color: #23466e;" class="p-2">
                    <!-- 원작웹툰 -->
                    {% for ori in origin %}
                        <li name="6" class="p-1 user_keyword">{{ori}}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<div id="select_keyword" class="d-flex">
    
</div>

<div id="output_keyword">

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
    const output=document.getElementById("output_keyword");
    const select_user=document.getElementById("select_keyword");
    let i=0;
    
    let select_user_keyword=[]
    $("li").on("click",function(event) {
        let keyword=$(this).attr('name')    //키워드 종류
        let user_keyword=$(this).text()     //user가 선택한 키워드명
       
        select_user_keyword.push(user_keyword)
        console.log(select_user_keyword)
        console.log(keyword)
        console.log(user_keyword)
        $.ajax ({
            type : "POST",  //데이터를 전송하는 방법
            url : "/input_keyword",
            data : {"keyword":keyword,"user_keyword":user_keyword},
            dataType : "json",
            success : function(response) {
                //alert(response["model_result"])
                //console.log(${response["keyword"]})

                for(i;i<select_user_keyword.length;i++) {
                    if(user_keyword==select_user_keyword[i]) {
                        select_user.innerHTML+=`
                            <div id="keyword_btn${i}">
                                <button type="button" class="btn btn-info">${select_user_keyword[i]}</button>
                                <button name="${i}" type="button" class="btn-close" aria-label="Close"></button>
                            </div>
                        `
                    }
                }
                
                $('.btn-close').on('click',function(event) {
                    index="keyword_btn"+$(this).attr('name')
                    console.log(index)
                    const close_number=document.getElementById(index)
                    console.log(close_number)
                    select_user_keyword.splice(index,1)
                    console.log(select_user_keyword)
                    close_number.innerHTML=''
                });

                const list_len=$(response["webtoon_title"]).length
                console.log(list_len)
                
                output.innerHTML=''
                for(let i=0;i<list_len;i++){
                    output.innerHTML+=`
                    <div id='reload_location'>
                        <div>
                            <img src='${response["webtoon_thumb"][i]}' style="width:100px; height:100px">
                        </div>
                        <div>
                            <p>${response["webtoon_title"][i]}</p>
                        </div>
                        <div>
                            <p>${response["webtoon_author"][i]}</p>
                        </div>
                        <div>
                            <p>${response["webtoon_intro"][i]}</p>
                        </div>
                    </div>   
                `
                }
                //$('#reload_location').load(location.href+'#reload_location')
            },
            error : function(request,status,error) {
                console.log("no ajax")
            }
        });
    })
</script>

<!-- 키워드 결과 출력(Ajax로 부분 새로고침) -->

<!---->
{% endblock %}